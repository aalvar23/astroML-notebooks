
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Measurement errors in both dependent and independent variables &#8212; AstroML Notebooks</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 9: Classification" href="../chapter9/README.html" />
    <link rel="prev" title="Measurement Errors in Linear Regression" href="astroml_chapter8_Regression.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/astroml_logo.gif" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">AstroML Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter5/README.html">
   Chapter 5: Bayesian Statistical Inference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter5/astroml_chapter5_Parameter_Estimation_for_Gaussian_Distribution.html">
     Parameter Estimation for a Gaussian Distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter5/astroml_chapter5_Parameter_Estimation_for_Binomial_Distribution.html">
     Parameter Estimation for a Binomial Distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter5/astroml_chapter5_Parameter_Estimation_for_Cauchy_Distribution.html">
     Parameter estimation for the Cauchy (Lorentzian) distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter5/astroml_chapter5_Approximate_Bayesian_Computation.html">
     Approximate Bayesian Computation Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter5/astroml_chapter5_Hierarchical_Bayes.html">
     Hierarchical Bayes Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter6/README.html">
   Chapter 6: Searching for Structure in Point Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter6/astroml_chapter6_Density_Estimation_for_SDSS_Great_Wall.html">
     Density Estimation for SDSS “Great Wall”
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter6/astroml_chapter6_Searching_for_Structure_in_Point_Data.html">
     Searching for Structure in Point Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter6/astroml_chapter6_Gaussian_Mixture_Models.html">
     Gaussian Mixture Models Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter6/astroml_chapter6_Extreme_Deconvolution.html">
     Extreme Deconvolution
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter7/README.html">
   Chapter 7: Dimensionality and its Reduction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter7/astroml_chapter7_Dimensionality_Reduction.html">
     Dimensionality reduction
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="README.html">
   Chapter 8: Regression and Model Fitting
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="astroml_chapter8_Regression.html">
     Measurement Errors in Linear Regression
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Measurement errors in both dependent and independent variables
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter9/README.html">
   Chapter 9: Classification
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter9/astroml_chapter9_Classification.html">
     Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter9/astroml_chapter9_Deep_Learning_Classifying_Astronomical_Images.html">
     Deep Learning: Classifying Astronomical Images
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter10/README.html">
   Chapter 10: Time Series Analysis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter10/astroml_chapter10_Modeling_Toolkit_for_Time_Series_Analysis.html">
     Modeling Toolkit For Time Series Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter10/astroml_chapter10_Wavelets.html">
     Wavelets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter10/astroml_chapter10_Digital_Filtering.html">
     Digital Filtering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter10/astroml_chapter10_Temporally_Localized_Signals.html">
     Temporally localized signals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter10/astroml_chapter10_Analysis_of_Stochastic_Processes.html">
     Analysis of Stochastic Processes
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../_sources/chapter8/astroml_chapter8_Regression_with_Errors_on_Dependent_and_Independent_Variables.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/chapter8/astroml_chapter8_Regression_with_Errors_on_Dependent_and_Independent_Variables.md.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/astroML/astroML-notebooks"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/astroML/astroML-notebooks/issues/new?title=Issue%20on%20page%20%2Fchapter8/astroml_chapter8_Regression_with_Errors_on_Dependent_and_Independent_Variables.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/astroML/astroML-notebooks/edit/main/chapter8/astroml_chapter8_Regression_with_Errors_on_Dependent_and_Independent_Variables.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/astroML/astroML-notebooks/main?urlpath=tree/chapter8/astroml_chapter8_Regression_with_Errors_on_Dependent_and_Independent_Variables.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-sets-used-in-the-examples-below">
   Data sets used in the examples below
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-the-generated-data">
     Plot the generated data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#linear-regression-with-uncertainties-in-both-dependent-and-independent-axes">
     Linear regression with uncertainties in both dependent and independent axes
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-the-results">
   Plot the results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multivariate-regression">
   Multivariate regression
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generate-a-dataset">
     Generate a dataset:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sampler-statistics-and-traceplots">
     Sampler statistics and traceplots
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="measurement-errors-in-both-dependent-and-independent-variables">
<h1>Measurement errors in both dependent and independent variables<a class="headerlink" href="#measurement-errors-in-both-dependent-and-independent-variables" title="Permalink to this headline">¶</a></h1>
<p>Regression defined as the relation between a dependent variable, <span class="math notranslate nohighlight">\(\eta_i\)</span>, and a set of independent
variables, <span class="math notranslate nohighlight">\(\xi_i\)</span>, that describes the expectation value of <span class="math notranslate nohighlight">\(\eta_i\)</span> given <span class="math notranslate nohighlight">\(\xi_i\)</span>.
There may be intrinsic scatter, <span class="math notranslate nohighlight">\(\epsilon_i\)</span>, too.</p>
<p>In most cases, however, what we observe are values <span class="math notranslate nohighlight">\(x_i\)</span> and <span class="math notranslate nohighlight">\(y_i\)</span> and
associated measurement errors, <span class="math notranslate nohighlight">\(\epsilon_{x,i}\)</span> and <span class="math notranslate nohighlight">\(\epsilon_{y,i}\)</span>.
Following <a class="reference external" href="https://iopscience.iop.org/article/10.1086/519947/pdf">Kelly 2007</a>,
we can write the regression relationship as:</p>
<div class="math notranslate nohighlight">
\[\eta_{i} = \alpha + \beta \xi_{i} + \epsilon_{i}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[x_{i} = \xi_{i} + \epsilon_{x,i}\]</div>
<div class="math notranslate nohighlight">
\[y_{i} = \eta_{i} + \epsilon_{y,i}\]</div>
<div class="section" id="data-sets-used-in-the-examples-below">
<h2>Data sets used in the examples below<a class="headerlink" href="#data-sets-used-in-the-examples-below" title="Permalink to this headline">¶</a></h2>
<p>Use simulation data from <a class="reference external" href="https://iopscience.iop.org/article/10.1086/519947/pdf">Kelly 2007</a>.
This simulator, called <code class="docutils literal notranslate"><span class="pre">simulation_kelly</span></code>  is available from <code class="docutils literal notranslate"><span class="pre">astroML.datasets</span></code>.</p>
<p>The function returns the <span class="math notranslate nohighlight">\(\xi_i\)</span>, <span class="math notranslate nohighlight">\(\eta_i\)</span>, <span class="math notranslate nohighlight">\(x_i\)</span>, <span class="math notranslate nohighlight">\(y_i\)</span>, <span class="math notranslate nohighlight">\(\epsilon_{x,i}\)</span>, <span class="math notranslate nohighlight">\(\epsilon_{y,i}\)</span> and
the input regression coefficients <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> and intrinsic scatter <span class="math notranslate nohighlight">\(\epsilon\)</span>.
A total of <code class="docutils literal notranslate"><span class="pre">size</span></code> values generated, measurement errors are scaled by parameters <code class="docutils literal notranslate"><span class="pre">scalex</span></code> and
<code class="docutils literal notranslate"><span class="pre">scaley</span></code> following secion 7.1 in <a class="reference external" href="https://iopscience.iop.org/article/10.1086/519947/pdf">Kelly 2007</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astroML.datasets</span> <span class="kn">import</span> <span class="n">simulation_kelly</span>

<span class="n">ksi</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">xi_error</span><span class="p">,</span> <span class="n">yi_error</span><span class="p">,</span> <span class="n">alpha_in</span><span class="p">,</span> <span class="n">beta_in</span> <span class="o">=</span> <span class="n">simulation_kelly</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">scalex</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">scaley</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                                                           <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="plot-the-generated-data">
<h3>Plot the generated data<a class="headerlink" href="#plot-the-generated-data" title="Permalink to this headline">¶</a></h3>
<p>Plot both the simulated <span class="math notranslate nohighlight">\(\xi\)</span>, <span class="math notranslate nohighlight">\(\eta\)</span> dataset as well the generated observed values of <span class="math notranslate nohighlight">\(x_i\)</span> and <span class="math notranslate nohighlight">\(y_i\)</span>
including their measurement errors for different values of the scale parameters <code class="docutils literal notranslate"><span class="pre">scalex</span></code> and <code class="docutils literal notranslate"><span class="pre">scaley</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">notebook</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ksi_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ksi</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ksi</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">eta_0</span> <span class="o">=</span> <span class="n">alpha_in</span> <span class="o">+</span> <span class="n">ksi_0</span> <span class="o">*</span> <span class="n">beta_in</span>

<span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">figure</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
                       <span class="n">bottom</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
                       <span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ksi</span><span class="p">,</span> <span class="n">eta</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\xi$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\eta$&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ksi_0</span><span class="p">,</span> <span class="n">eta_0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">scalex</span><span class="p">,</span> <span class="n">scaley</span><span class="p">,</span> <span class="n">axn</span> <span class="ow">in</span> <span class="p">[(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">222</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">224</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">223</span><span class="p">)]:</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">xi_error</span><span class="p">,</span> <span class="n">yi_error</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">simulation_kelly</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">scalex</span><span class="o">=</span><span class="n">scalex</span><span class="p">,</span> <span class="n">scaley</span><span class="o">=</span><span class="n">scaley</span><span class="p">,</span>
                                                              <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_in</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta_in</span><span class="p">,</span> <span class="n">ksi</span><span class="o">=</span><span class="n">ksi</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="n">eta</span><span class="p">)</span>    
    <span class="n">ax</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">axn</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yi</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yi</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">xi_error</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yi_error</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x, error scaler: </span><span class="si">{</span><span class="n">scalex</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;y, error scaler: </span><span class="si">{</span><span class="n">scaley</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">alpha_in</span> <span class="o">+</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">beta_in</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>

   
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="linear-regression-with-uncertainties-in-both-dependent-and-independent-axes">
<h3>Linear regression with uncertainties in both dependent and independent axes<a class="headerlink" href="#linear-regression-with-uncertainties-in-both-dependent-and-independent-axes" title="Permalink to this headline">¶</a></h3>
<p>The class <code class="docutils literal notranslate"><span class="pre">LinearRegressionwithErrors</span></code> can be used to take into account measurement errors in
both the dependent and independent variables.
The implementation relies on the <a class="reference external" href="https://docs.pymc.io/">PyMC3</a> and <a class="reference external" href="http://deeplearning.net/software/theano/">Theano</a>
packages.</p>
<p>Note: The first initialization of the fitter is expected to take a couple of minutes, as <code class="docutils literal notranslate"><span class="pre">Theano</span></code>
performs some code compilation for the underlying model. Sampling for consecutive runs is expected
to start up significantly faster.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astroML.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegressionwithErrors</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">linreg_xy_err</span> <span class="o">=</span> <span class="n">LinearRegressionwithErrors</span><span class="p">()</span>
<span class="n">linreg_xy_err</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">yi_error</span><span class="p">,</span> <span class="n">xi_error</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-the-results">
<h2>Plot the results<a class="headerlink" href="#plot-the-results" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astroML.plotting</span> <span class="kn">import</span> <span class="n">plot_regressions</span><span class="p">,</span> <span class="n">plot_regression_from_trace</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot_regressions</span><span class="p">(</span><span class="n">ksi</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yi</span><span class="p">,</span> <span class="n">xi_error</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yi_error</span><span class="p">,</span> <span class="n">add_regression_lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha_in</span><span class="o">=</span><span class="n">alpha_in</span><span class="p">,</span> <span class="n">beta_in</span><span class="o">=</span><span class="n">beta_in</span><span class="p">)</span>
<span class="n">plot_regression_from_trace</span><span class="p">(</span><span class="n">linreg_xy_err</span><span class="p">,</span> <span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">xi_error</span><span class="p">,</span> <span class="n">yi_error</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">chains</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="multivariate-regression">
<h2>Multivariate regression<a class="headerlink" href="#multivariate-regression" title="Permalink to this headline">¶</a></h2>
<p>For multivariate data (where we fit a hyperplane rather than a straight line) we simply extend the description
of the regression function to multiple dimensions. The formalism used in the previous example becomes:</p>
<div class="math notranslate nohighlight">
\[ \eta_i = \alpha + \beta^T \xi_i + \epsilon_i \]</div>
<p>where both <span class="math notranslate nohighlight">\(\beta^T\)</span> and <span class="math notranslate nohighlight">\(\xi_i\)</span> are now N-element vectors.</p>
<div class="section" id="generate-a-dataset">
<h3>Generate a dataset:<a class="headerlink" href="#generate-a-dataset" title="Permalink to this headline">¶</a></h3>
<p>We use the same function as above to generate 100 datapoints in 2 dimensions. Note that the size of the <code class="docutils literal notranslate"><span class="pre">beta</span></code>
parameter needs to match the dimensions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ksi2</span><span class="p">,</span> <span class="n">eta2</span><span class="p">,</span> <span class="n">xi2</span><span class="p">,</span> <span class="n">yi2</span><span class="p">,</span> <span class="n">xi_error2</span><span class="p">,</span> <span class="n">yi_error2</span><span class="p">,</span> <span class="n">alpha_in2</span><span class="p">,</span> <span class="n">beta_in2</span> <span class="o">=</span> <span class="n">simulation_kelly</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">scalex</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">scaley</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                                                                   <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                                                                   <span class="n">multidim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The previously used <code class="docutils literal notranslate"><span class="pre">LinearRegressionwithErrors</span></code> class can be used with multidimensional data, thus the fitting is done the exact same way as before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">linreg_xy_err2</span> <span class="o">=</span> <span class="n">LinearRegressionwithErrors</span><span class="p">()</span>
<span class="n">linreg_xy_err2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xi2</span><span class="p">,</span> <span class="n">yi2</span><span class="p">,</span> <span class="n">yi_error2</span><span class="p">,</span> <span class="n">xi_error2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>There are several ways to explore the fits, in the following we show a few ways to plot this dataset. As in this example the fitted hyperplane was 2D, we can use a 3D plot to show both the fit and the underlying regession we used to generate the data from. In this 3D plot, the blue plane is the true regression, while the red plane is our fit, that takes into account the errors on the data points.</p>
<p>Other plotting libraries can also be used to e.g. create pairplots of the parameters (e.g. Arviz’ <code class="docutils literal notranslate"><span class="pre">plot_pair</span></code> function, or Seaborn’s <code class="docutils literal notranslate"><span class="pre">jointplot</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xi2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xi2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xi2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xi2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>

<span class="n">y0</span> <span class="o">=</span> <span class="n">alpha_in</span> <span class="o">+</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">beta_in2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">beta_in2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">y_fitted</span> <span class="o">=</span> <span class="n">linreg_xy_err2</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">linreg_xy_err2</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">linreg_xy_err2</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;xi2[0] &#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;xi2[1] &#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;yi2 &#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xi2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xi2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">yi2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True regression&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y_fitted</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fitted regression&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sampler-statistics-and-traceplots">
<h3>Sampler statistics and traceplots<a class="headerlink" href="#sampler-statistics-and-traceplots" title="Permalink to this headline">¶</a></h3>
<p>The PyMC3 trace is available in the <code class="docutils literal notranslate"><span class="pre">.trace</span></code> attribute of the class instances (e.g. <code class="docutils literal notranslate"><span class="pre">linreg_xy_err2.trace</span></code> in the previous example), after we performed the fit. This can be then used for checking for convergence, and generating statistics for the samples. We would refer to use the tools provided by PyMC3, e.g. the <code class="docutils literal notranslate"><span class="pre">traceplot()</span></code> that takes the trace object as its input. Note that in the multidimensional case, there will be multiple <code class="docutils literal notranslate"><span class="pre">ksi</span></code> and <code class="docutils literal notranslate"><span class="pre">slope</span></code> traces in aggreement with the dimensionality of the input <code class="docutils literal notranslate"><span class="pre">xi</span></code> data, in the <code class="docutils literal notranslate"><span class="pre">traceplot</span></code> they are plotted with different colours.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymc3</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">pm</span><span class="o">.</span><span class="n">traceplot</span><span class="p">(</span><span class="n">linreg_xy_err2</span><span class="o">.</span><span class="n">trace</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>


              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="astroml_chapter8_Regression.html" title="previous page">Measurement Errors in Linear Regression</a>
    <a class='right-next' id="next-link" href="../chapter9/README.html" title="next page">Chapter 9: Classification</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By AstroML developers<br/>
        
            &copy; Copyright 2020-2021, AstroML developers.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>